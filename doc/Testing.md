# 详细的产测步骤

### 一些问题

+ 如果串口连锡了怎么办
+ eMMC完全损坏导致的不启动有什么log
+ 什么时候可以拔掉产测线缆（弹窗？）

## 步骤零：产测主机初始化

+ 检测USB小板是否存在/损坏
  + 检测不到USB小板：找不到串口+连接失败多次
+ 检测HDMI采集是否存在
+ 检测打印机是否存在
+ 如果不存在则弹窗警告

## 步骤一：初始化

+ 串口状态检测
  + 未连接：超过5s没有发送任何字符，发送回车无响应
  + 已连接：重启所有程序的标志：找到串口+连接失败多次后连接成功
  + 正在启动：超时5s内检测到[  OK  ]
  + 等待登录：检测到login
  + 已经登录：检测到Welcome后检测到#
    + 网络配置：
      + 静态IP：设置完成后上报
      + 动态IP：等待有IP后上报
    + 若近5s内没有数据，发送回车无响应，则回到未连接状态
  
+ 如果长时间（10s+）未连接，则弹窗请接入测试样品，如果已经接入就点击打印错误贴纸（没有标识贴纸），或者点击取消，清零倒计时

+ 主机设置IP/或不设置

+ 等待串口获取IP并尝试Ping通

+ SSH连接

+ 检测是否存在已产测信息
  + 若存在
    + 检测核心板+底板是否匹配

    + 弹窗（底板已更换）是否重新完整测试

    + 更新产测信息（比如屏幕需要重测）

+ 检测硬件-更新硬件状态（如果两个I2C都没有检测到就弹窗手动选择）

+ 下载产测内容

+ 退出SSH登录

## 步骤二：项目测试

## 步骤三：应用设置





### 小章节：仅通过串口如何做状态管理

+ 串口接口通过一个单独的进程控制读写，所有数据通过两个队列传输
+ 提供队列的读写函数以及读取时候的ANSI格式清除函数
+ 单独一个进程用于串口状态管理和接收信息，功能如下，状态：未连接、启动中、已登陆、错误
  + 是否连接工具
    + 找不到串口：清除其他，count++（MAX：100）
    + 找到串口连接不到：清除其他，count++（MAX：100）
    + 找到串口连接到：状态二count小于6进入已连接，否则清除所有count，进入未连接
  + 任意状态下启用计时器，最大值100s，封顶后归10
  + 任意状态下：只要接收到任何数据计时清零，进入已连接
  + 任意状态下：计时器%5s自动发送回车清零计时器，如无消息进入未连接状态，有消息进入已连接
  + 未连接状态：只要计时大于等于10s就发送弹窗，点击取消就清除倒计时，点击打印不良也清除倒计时同时触发打印选项
  + （暂态/上升沿/函数自动判断）一旦进入已连接，先设置定时器B（清零+开始）
  + 任意状态下：只要出现检测[ OK ]，并进入启动中
  + 任意状态下：定时器B大于60s，进入错误状态，触发弹窗：等待or打印不良贴纸（启动异常，建议重烧镜像）
  + 任意状态下：只要出现login，就自动登录（），等待Welcome + #，进入已登录，停止定时器B
  + 已登录后执行获取IP操作，如果未获取到就重复，直到获取到IP，超过10次获取不到就弹窗提醒连接以太网/打印不良

### 小章节：弹窗管理

+ 需要设置弹窗队列
+ 单个弹窗使用一个进程管理，避免重复触发
+ 可以设置的按键数量+内容：0、1、2
+ 可以设置的弹窗信息